<!-- templates/admin/base_admin.html -->
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <link rel="icon" href="{{ url_for('static', path='favicon.ico') }}">
  <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', path='favicon-32.png') }}">
  <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', path='favicon-16.png') }}">
  <title>{% block title %}GPT 관리자{% endblock %}</title>

  <!-- ✅ 정적 파일은 url_for('static', path=...) 사용 -->
  <link rel="stylesheet" href="{{ url_for('static', path='css/admin/base.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', path='css/admin/users.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', path='css/admin/category_dropdown.css') }}" />

  {% block head %}{% endblock %}
</head>
<body>

<div class="admin-layout">
  <!-- 왼쪽 사이드바 -->
  <aside class="sidebar">
    <div class="logo">
      <span class="logo-text">GPT Admin</span>
    </div>

    <nav class="sidebar-menu">
      <a href="/admin/dashboard" class="{{ 'active' if active_page == 'dashboard' else '' }}">대시보드</a>
      <a href="/admin/users" class="{{ 'active' if active_page == 'users' else '' }}">회원관리</a>

      <!-- ▼ 카테고리게시물 (현재 게시판이면 자동으로 펼침) -->
      {% set is_posts_section = ('posts_' in (active_page or '')) %}
      <div class="menu-group">
        <button type="button"
                class="menu-toggle {{ 'active' if is_posts_section else '' }}"
                aria-expanded="{{ 'true' if is_posts_section else 'false' }}">
          카테고리게시물 ▾
        </button>

        <div class="submenu {{ 'open' if is_posts_section else '' }}">
          <a href="{{ request.url_for('admin_board_list', board='best')    }}" class="{{ 'active' if active_page=='posts_best' else '' }}">베스트</a>
          <a href="{{ request.url_for('admin_board_list', board='game')    }}" class="{{ 'active' if active_page=='posts_game' else '' }}">게임</a>
          <a href="{{ request.url_for('admin_board_list', board='sports')  }}" class="{{ 'active' if active_page=='posts_sports' else '' }}">스포츠</a>
          <a href="{{ request.url_for('admin_board_list', board='invest')  }}" class="{{ 'active' if active_page=='posts_invest' else '' }}">투자</a>
          <a href="{{ request.url_for('admin_board_list', board='gallery') }}" class="{{ 'active' if active_page=='posts_gallery' else '' }}">갤러리</a>
          <a href="{{ request.url_for('admin_board_list', board='free')    }}" class="{{ 'active' if active_page=='posts_free' else '' }}">일반</a>
          <a href="{{ request.url_for('admin_board_list', board='humor')   }}" class="{{ 'active' if active_page=='posts_humor' else '' }}">유머</a>
          <a href="{{ request.url_for('admin_board_list', board='report')  }}" class="{{ 'active' if active_page=='posts_report' else '' }}">신문고</a>
        </div>
      </div>

      <a href="/admin/events" class="{{ 'active' if active_page == 'events' else '' }}">이벤트</a>
      <a href="/admin/live"   class="{{ 'active' if active_page == 'live'   else '' }}">라이브</a>

      <!-- ✅ 관리자 로그아웃: POST + next -->
      <form method="post" action="/admin/logout">
  <input type="hidden" name="next" value="/admin/login">
  <button type="submit">로그아웃</button>
</form>
    </nav>
  </aside>

  <!-- 오른쪽 메인 컨텐츠 -->
  <div class="main-content">
    <header class="topbar">
      <div class="topbar-left">
        <h2>{% block page_title %}관리자 대시보드{% endblock %}</h2>
      </div>
      <div class="topbar-right">
        <span class="topbar-icon">🔔</span>
        <span class="topbar-avatar">👤</span>
      </div>
    </header>

    <div class="dashboard-content">
      {% block content %}{% endblock %}
    </div>
  </div>
</div>

<!-- 드롭다운 토글 -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const toggles = document.querySelectorAll(".menu-toggle");
  toggles.forEach(btn => {
    btn.addEventListener("click", (e) => {
      e.preventDefault();
      const submenu = btn.nextElementSibling;
      const willOpen = !submenu.classList.contains("open");

      // 다른 열린 서브메뉴 닫기(필요시 유지)
      document.querySelectorAll(".submenu.open").forEach(el => {
        if (el !== submenu) el.classList.remove("open");
      });

      submenu.classList.toggle("open", willOpen);
      btn.setAttribute("aria-expanded", String(willOpen));
    });
  });
});
</script>
</body>
</html>
